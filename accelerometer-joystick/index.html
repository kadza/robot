<!doctype html>
<html>

<head>
    <title>Robot joystick</title>
    <meta name="description" content="Robot joystick">
</head>
<script>
    const exampleSocket = new WebSocket("ws://localhost:8765");
    exampleSocket.onopen = () => {
        document.getElementById("connection-status").innerHTML = "Connected"
    };

    exampleSocket.onmessage = (event) => {
        console.log(event.data)
        document.getElementById("message-status").innerHTML = event.data
    }

    function sendMessage(message) {
        exampleSocket.send(JSON.stringify(message))
    }

    let alpha, beta, gamma = 0
    const pi = Math.PI

    function requestPermissions() {
        DeviceMotionEvent.requestPermission()
            .then(response => {
                if (response == 'granted') {
                    window.addEventListener('devicemotion', (e) => {
                        alpha = e.rotationRate.alpha * (180/pi)
                        beta = e.rotationRate.beta * (180/pi)
                        gamma = e.rotationRate.gamma * (180/pi)
                    })
                }
            })
            .catch(console.error)
    }

    setInterval(() => {
        document.getElementById("rot-z").innerHTML = alpha
        document.getElementById("rot-x").innerHTML = beta
        document.getElementById("rot-y").innerHTML = gamma
    }, 1500)
</script>

<body>
    <button onclick="requestPermissions()">Start</button>
    <button onclick="sendMessage({direction: 'up', value: 1})">test</button>
    <p id="connection-status">Connecting ...</p>
    <p id="acc-x"></p>
    <p id="acc-y"></p>
    <p id="acc-z"></p>
    <p id="rot-x"></p>
    <p id="rot-y"></p>
    <p id="rot-z"></p>
</body>

</html>