<!doctype html>
<html>

<head>
    <title>Robot joystick</title>
    <meta name="description" content="Robot joystick">
</head>
<script>
    const exampleSocket = new WebSocket("ws://localhost:8765");
    exampleSocket.onopen = () => {
        document.getElementById("connection-status").innerHTML = "Connected"
    };

    exampleSocket.onmessage = (event) => {
        console.log(event.data)
        document.getElementById("message-status").innerHTML = event.data
    }

    function sendMessage(message) {
        exampleSocket.send(JSON.stringify(message))
    }

    let event = {
        alpha: 0,
        beta: 0,
        gamma: 0
    }

    function requestPermissions() {
        DeviceOrientationEvent.requestPermission()
            .then(response => {
                if (response == 'granted') {
                    window.addEventListener("deviceorientation", (e) => event = e);
                }
            })
            .catch((e) =>
                document.getElementById("error").innerHTML = e.message)
    }

    setInterval(() => {
        document.getElementById("rot-z").innerHTML = event.alpha
        document.getElementById("rot-x").innerHTML = event.beta
        document.getElementById("rot-y").innerHTML = event.gamma
    }, 1500)
</script>

<body>
    <button onclick="requestPermissions()">Start</button>
    <button onclick="sendMessage({direction: 'up', value: 1})">test</button>
    <p id="connection-status">Connecting ...</p>
    <p id="rot-x"></p>
    <p id="rot-y"></p>
    <p id="rot-z"></p>
</body>

</html>