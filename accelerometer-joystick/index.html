<!doctype html>
<html>

<head>
    <title>Robot joystick</title>
    <meta name="description" content="Robot joystick">
</head>
<script>
    const exampleSocket = new WebSocket("wss://192.168.0.213:8765");
    exampleSocket.onopen = () => {
        document.getElementById("connection-status").innerHTML = "Connected"
    };

    exampleSocket.onmessage = (event) => {
        console.log(event.data)
        document.getElementById("message-status").innerHTML = event.data
    }

    function sendMessage(message) {
        exampleSocket.send(JSON.stringify(message))
    }

    async function requestPermissions() {
        try {
            const response = await DeviceOrientationEvent.requestPermission()
            if (response == 'granted') {
                window.addEventListener("deviceorientation", (e) => {
                    document.getElementById("rot-z").innerHTML = Math.round(event.alpha)
                    document.getElementById("rot-x").innerHTML = Math.round(event.beta)
                    document.getElementById("rot-y").innerHTML = Math.round(event.gamma)
                });
            }
        } catch (e) {
            document.getElementById("error").innerHTML = e.message
        }
    }
</script>

<body>
    <button onclick="requestPermissions()">Start</button>
    <button onclick="sendMessage({direction: 'up', value: 1})">test</button>
    <p id="connection-status">Connecting ...</p>
    <p id="rot-x"></p>
    <p id="rot-y"></p>
    <p id="rot-z"></p>
</body>

</html>